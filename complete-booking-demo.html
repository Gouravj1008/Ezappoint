<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Booking Demo - API Testing</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .panel {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .panel h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .step {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .step.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        button {
            width: 100%;
            padding: 12px 20px;
            margin: 10px 0;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #51cf66, #37b24d);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(81, 207, 102, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .form-group {
            margin: 15px 0;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 600;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #eee;
            border-radius: 5px;
            font-size: 0.95rem;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.2);
        }

        .status-box {
            background: #f5f5f5;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .status-success {
            border-left-color: #51cf66;
            background: #f1fce4;
        }

        .status-error {
            border-left-color: #ff6b6b;
            background: #ffe0e0;
        }

        .status-warning {
            border-left-color: #ffd93d;
            background: #fffbec;
        }

        .progress-bar {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            justify-content: space-around;
        }

        .progress-step {
            flex: 1;
            padding: 10px;
            text-align: center;
            border-radius: 5px;
            font-weight: bold;
            background: #eee;
            color: #999;
            transition: all 0.3s;
        }

        .progress-step.completed {
            background: #51cf66;
            color: white;
        }

        .progress-step.active {
            background: #667eea;
            color: white;
            transform: scale(1.05);
        }

        .confirmation-card {
            background: linear-gradient(135deg, #51cf66, #37b24d);
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }

        .token-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 15px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: bold;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            color: #1976D2;
        }

        .slots-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .slot-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .slot-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .slot-card.selected {
            border-color: #ffd700;
            box-shadow: 0 0 20px #ffd700;
        }

        .slot-card small {
            display: block;
            margin-top: 8px;
            opacity: 0.9;
        }

        .next-btn {
            margin-top: 20px;
        }

        .error-msg {
            color: #ff6b6b;
            font-weight: bold;
            margin: 10px 0;
            padding: 10px;
            background: #ffe0e0;
            border-radius: 5px;
        }

        .success-msg {
            color: #51cf66;
            font-weight: bold;
            margin: 10px 0;
            padding: 10px;
            background: #f1fce4;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè• Complete Appointment Booking System</h1>

        <div class="progress-bar">
            <div class="progress-step active" id="step1-indicator">1Ô∏è‚É£ Register/Login</div>
            <div class="progress-step" id="step2-indicator">2Ô∏è‚É£ Create Slots</div>
            <div class="progress-step" id="step3-indicator">3Ô∏è‚É£ Search Slots</div>
            <div class="progress-step" id="step4-indicator">4Ô∏è‚É£ Book Appointment</div>
            <div class="progress-step" id="step5-indicator">5Ô∏è‚É£ Confirmation</div>
        </div>

        <div class="grid">
            <!-- STEP 1: USER REGISTRATION/LOGIN -->
            <div class="panel">
                <h2>Step 1: Register/Login</h2>
                <div class="step active" id="step1">
                    <div class="info-box">
                        ‚ÑπÔ∏è Create an account or login. We'll auto-fill a test user.
                    </div>

                    <div class="form-group">
                        <label for="signup-username">Username:</label>
                        <input type="text" id="signup-username" placeholder="Enter username">
                    </div>

                    <div class="form-group">
                        <label for="signup-email">Email:</label>
                        <input type="email" id="signup-email" placeholder="Enter email">
                    </div>

                    <div class="form-group">
                        <label for="signup-phone">Phone:</label>
                        <input type="text" id="signup-phone" placeholder="Enter 10-digit phone">
                    </div>

                    <div class="form-group">
                        <label for="signup-location">Location:</label>
                        <input type="text" id="signup-location" placeholder="Enter location" value="Mumbai">
                    </div>

                    <div class="form-group">
                        <label for="signup-password">Password:</label>
                        <input type="password" id="signup-password" placeholder="Enter password">
                    </div>

                    <button class="btn-primary" onclick="autoFillSignup()">üìù Auto-Fill Test User</button>
                    <button class="btn-success" onclick="stepRegisterUser()">‚úÖ Register User</button>

                    <div id="status-step1" class="status-box" style="display:none;"></div>
                </div>
            </div>

            <!-- STEP 2: CREATE SLOTS -->
            <div class="panel">
                <h2>Step 2: Create Slots</h2>
                <div class="step" id="step2">
                    <div class="info-box">
                        ‚ÑπÔ∏è Create sample hospital slots for testing bookings.
                    </div>

                    <p>Select slot type to create:</p>
                    <button class="btn-primary" onclick="createCardiology()">‚ù§Ô∏è Cardiology Slots</button>
                    <button class="btn-primary" onclick="createNeurology()">üß† Neurology Slots</button>
                    <button class="btn-primary" onclick="createDentistry()">ü¶∑ Dentistry Slots</button>
                    <button class="btn-danger" onclick="createEmergency()">üö® Emergency Slots</button>

                    <div id="status-step2" class="status-box" style="display:none;"></div>
                </div>
            </div>

            <!-- STEP 3: SEARCH SLOTS -->
            <div class="panel">
                <h2>Step 3: Search Slots</h2>
                <div class="step" id="step3">
                    <div class="info-box">
                        ‚ÑπÔ∏è Search for available slots in the database.
                    </div>

                    <div class="form-group">
                        <label for="search-date">Date:</label>
                        <input type="date" id="search-date">
                    </div>

                    <div class="form-group">
                        <label for="search-location">Location:</label>
                        <input type="text" id="search-location" placeholder="e.g., Mumbai">
                    </div>

                    <div class="form-group">
                        <label for="search-specialization">Specialization (Optional):</label>
                        <input type="text" id="search-specialization" placeholder="e.g., Cardiology">
                    </div>

                    <button class="btn-success" onclick="stepSearchSlots()">üîç Search Slots</button>

                    <h3 style="margin-top: 20px; color: #667eea;">Available Slots:</h3>
                    <div id="slots-display" class="slots-grid"></div>

                    <div id="status-step3" class="status-box" style="display:none;"></div>
                </div>
            </div>

            <!-- STEP 4: BOOK APPOINTMENT -->
            <div class="panel">
                <h2>Step 4: Book Appointment</h2>
                <div class="step" id="step4">
                    <div id="selected-slot-info"></div>

                    <div class="form-group">
                        <label for="patient-name">Patient Name:</label>
                        <input type="text" id="patient-name" placeholder="Enter patient name">
                    </div>

                    <div class="form-group">
                        <label for="patient-contact">Contact Number:</label>
                        <input type="text" id="patient-contact" placeholder="Enter 10-digit contact" maxlength="10">
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="emergency-check"> üö® Emergency Booking
                        </label>
                    </div>

                    <div id="emergency-reason-div" style="display:none;">
                        <div class="form-group">
                            <label for="emergency-reason">Reason for Emergency:</label>
                            <textarea id="emergency-reason" placeholder="Describe your medical emergency..." rows="3"></textarea>
                        </div>
                    </div>

                    <button class="btn-success" onclick="stepBookAppointment()">üéüÔ∏è Book Appointment</button>

                    <div id="status-step4" class="status-box" style="display:none;"></div>
                </div>
            </div>

            <!-- STEP 5: CONFIRMATION -->
            <div class="panel">
                <h2>Step 5: Confirmation</h2>
                <div class="step" id="step5">
                    <div id="confirmation-display"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script>
        const API_BASE = API_URL || "http://localhost:5000";
        let authToken = null;
        let selectedSlot = null;
        let availableSlots = [];

        // Auto-fill signup form
        function autoFillSignup() {
            const timestamp = Date.now();
            document.getElementById("signup-username").value = `user_${timestamp}`;
            document.getElementById("signup-email").value = `user${timestamp}@test.com`;
            document.getElementById("signup-phone").value = `98${Math.floor(Math.random() * 100000000).toString().padStart(8, '0')}`;
            document.getElementById("signup-password").value = "test123456";
        }

        // Step 1: Register User
        async function stepRegisterUser() {
            const username = document.getElementById("signup-username").value.trim();
            const email = document.getElementById("signup-email").value.trim();
            const phoneNumber = document.getElementById("signup-phone").value.trim();
            const location = document.getElementById("signup-location").value.trim();
            const password = document.getElementById("signup-password").value.trim();

            const status = document.getElementById("status-step1");
            status.style.display = "block";
            status.className = "status-box";
            status.textContent = "üîÑ Registering user...\n";

            try {
                // Register
                const signupRes = await fetch(`${API_BASE}/api/auth/signup`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ username, email, phoneNumber, location, password })
                });

                const signupData = await signupRes.json();
                
                if (!signupRes.ok) {
                    status.className = "status-box status-error";
                    status.textContent += `‚ùå Signup failed: ${signupData.message}\n`;
                    return;
                }

                status.textContent += `‚úÖ User registered: ${username}\n\nüîÑ Logging in...\n`;

                // Login
                const loginRes = await fetch(`${API_BASE}/api/auth/login`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ username, password })
                });

                const loginData = await loginRes.json();

                if (!loginRes.ok) {
                    status.className = "status-box status-error";
                    status.textContent += `‚ùå Login failed: ${loginData.message}\n`;
                    return;
                }

                authToken = loginData.token;
                localStorage.setItem("jwtToken", authToken);

                status.className = "status-box status-success";
                status.textContent += `‚úÖ Login successful!\nüéüÔ∏è Token: ${authToken.substring(0, 40)}...\n`;

                moveToStep(2);
            } catch (error) {
                status.className = "status-box status-error";
                status.textContent += `‚ùå Error: ${error.message}\n`;
            }
        }

        // Step 2: Create Slots
        async function createSlots(organizationName, location, doctors, isEmergency = false) {
            const status = document.getElementById("status-step2");
            status.style.display = "block";
            status.textContent += `\nüì§ Creating ${organizationName} slots...\n`;

            try {
                const response = await fetch(`${API_BASE}/api/organization/save-details`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        organizationName,
                        address: location,
                        doctors,
                        isEmergencySlot: isEmergency
                    })
                });

                const result = await response.json();

                if (!response.ok) {
                    status.className = "status-box status-error";
                    status.textContent += `‚ùå Failed: ${result.message}\n`;
                    return;
                }

                status.className = "status-box status-success";
                status.textContent += `‚úÖ Created ${result.slots.length} slots\n`;
            } catch (error) {
                status.className = "status-box status-error";
                status.textContent += `‚ùå Error: ${error.message}\n`;
            }
        }

        async function createCardiology() {
            const status = document.getElementById("status-step2");
            status.className = "status-box";
            status.textContent = "üîÑ Creating Cardiology Slots...\n";

            const tomorrow = getNextDate(1);
            const dayAfter = getNextDate(2);

            await createSlots("Apollo Hospital", "Mumbai", [
                { name: "Dr. Rajesh Kumar", specialization: "Cardiology", availableDate: tomorrow, timeFrom: "09:00 AM", timeTo: "12:00 PM", noOfTokens: 15 },
                { name: "Dr. Priya Singh", specialization: "Cardiology", availableDate: dayAfter, timeFrom: "02:00 PM", timeTo: "05:00 PM", noOfTokens: 12 }
            ]);
        }

        async function createNeurology() {
            const status = document.getElementById("status-step2");
            status.className = "status-box";
            status.textContent = "üîÑ Creating Neurology Slots...\n";

            const tomorrow = getNextDate(1);
            const dayAfter = getNextDate(2);

            await createSlots("Max Healthcare", "New Delhi", [
                { name: "Dr. Amit Patel", specialization: "Neurology", availableDate: tomorrow, timeFrom: "10:00 AM", timeTo: "01:00 PM", noOfTokens: 10 },
                { name: "Dr. Neha Gupta", specialization: "Neurology", availableDate: dayAfter, timeFrom: "03:00 PM", timeTo: "06:00 PM", noOfTokens: 10 }
            ]);
        }

        async function createDentistry() {
            const status = document.getElementById("status-step2");
            status.className = "status-box";
            status.textContent = "üîÑ Creating Dentistry Slots...\n";

            const tomorrow = getNextDate(1);
            const dayAfter = getNextDate(2);

            await createSlots("Dental Care Clinic", "Bangalore", [
                { name: "Dr. Vishal Dey", specialization: "Dentistry", availableDate: tomorrow, timeFrom: "08:00 AM", timeTo: "11:00 AM", noOfTokens: 20 },
                { name: "Dr. Anjali Sharma", specialization: "Dentistry", availableDate: dayAfter, timeFrom: "01:00 PM", timeTo: "04:00 PM", noOfTokens: 18 }
            ]);
        }

        async function createEmergency() {
            const status = document.getElementById("status-step2");
            status.className = "status-box";
            status.textContent = "üîÑ Creating Emergency Slots...\n";

            const today = getNextDate(0);

            await createSlots("Emergency Center", "Mumbai", [
                { name: "Dr. Emergency One", specialization: "General Medicine", availableDate: today, timeFrom: "12:00 AM", timeTo: "06:00 AM", noOfTokens: 5 },
                { name: "Dr. Emergency Two", specialization: "Trauma Surgery", availableDate: today, timeFrom: "06:00 AM", timeTo: "12:00 PM", noOfTokens: 5 }
            ]);
        }

        // Step 3: Search Slots
        async function stepSearchSlots() {
            const date = document.getElementById("search-date").value;
            const location = document.getElementById("search-location").value.trim();
            const specialization = document.getElementById("search-specialization").value.trim();

            const status = document.getElementById("status-step3");
            status.style.display = "block";
            status.className = "status-box";
            status.textContent = "üîÑ Searching slots...\n";

            try {
                const params = new URLSearchParams({ date, location });
                if (specialization) params.append("specialization", specialization);

                const response = await fetch(`${API_BASE}/api/organization/available-slots?${params}`, {
                    method: "GET",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${authToken}`
                    }
                });

                const result = await response.json();

                if (!response.ok) {
                    status.className = "status-box status-error";
                    status.textContent += `‚ùå Error: ${result.message}\n`;
                    return;
                }

                availableSlots = result.slots || [];
                status.className = "status-box status-success";
                status.textContent += `‚úÖ Found ${availableSlots.length} slots\n\nSlots:\n${JSON.stringify(availableSlots, null, 2)}`;

                displaySlots();
                moveToStep(4);
            } catch (error) {
                status.className = "status-box status-error";
                status.textContent += `‚ùå Error: ${error.message}\n`;
            }
        }

        function displaySlots() {
            const container = document.getElementById("slots-display");
            container.innerHTML = "";

            if (availableSlots.length === 0) {
                container.innerHTML = '<p style="color: red;">No slots found</p>';
                return;
            }

            availableSlots.forEach((slot, index) => {
                const card = document.createElement("div");
                card.className = "slot-card";
                card.onclick = () => selectSlot(index, card);
                card.innerHTML = `
                    <strong>${slot.doctorName}</strong>
                    <small>${slot.specialization}</small>
                    <small>${slot.timeSlot}</small>
                    <small>üìç ${slot.location}</small>
                    <small>Available: ${slot.availableSlots}/${slot.totalSlots}</small>
                `;
                container.appendChild(card);
            });
        }

        function selectSlot(index, element) {
            document.querySelectorAll(".slot-card").forEach(card => card.classList.remove("selected"));
            element.classList.add("selected");
            selectedSlot = availableSlots[index];

            const infoDiv = document.getElementById("selected-slot-info");
            infoDiv.innerHTML = `
                <div class="info-box">
                    <strong>Selected Slot:</strong><br>
                    ${selectedSlot.doctorName} (${selectedSlot.specialization})<br>
                    ${selectedSlot.timeSlot} | ${selectedSlot.location}
                </div>
            `;
        }

        // Step 4: Book Appointment
        async function stepBookAppointment() {
            if (!selectedSlot) {
                alert("‚ùå Please select a slot first");
                return;
            }

            const patientName = document.getElementById("patient-name").value.trim();
            const contactNumber = document.getElementById("patient-contact").value.trim();
            const isEmergency = document.getElementById("emergency-check").checked;
            const emergencyReason = document.getElementById("emergency-reason").value.trim();

            const status = document.getElementById("status-step4");
            status.style.display = "block";
            status.className = "status-box";
            status.textContent = "üîÑ Booking appointment...\n";

            // Validate
            if (!patientName) {
                status.className = "status-box status-error";
                status.textContent += "‚ùå Patient name is required\n";
                return;
            }

            if (contactNumber.length !== 10) {
                status.className = "status-box status-error";
                status.textContent += `‚ùå Contact must be 10 digits (got ${contactNumber.length})\n`;
                return;
            }

            if (isEmergency && !emergencyReason) {
                status.className = "status-box status-error";
                status.textContent += "‚ùå Emergency reason is required\n";
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/appointments`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        slotId: selectedSlot._id,
                        patientName,
                        contactNumber,
                        isEmergency,
                        emergencyReason
                    })
                });

                const result = await response.json();

                if (!response.ok) {
                    status.className = "status-box status-error";
                    status.textContent += `‚ùå Booking failed: ${result.message}\n`;
                    return;
                }

                status.className = "status-box status-success";
                status.textContent += `‚úÖ Appointment booked!\n\nResponse:\n${JSON.stringify(result, null, 2)}`;

                showConfirmation(result);
                moveToStep(5);
            } catch (error) {
                status.className = "status-box status-error";
                status.textContent += `‚ùå Error: ${error.message}\n`;
            }
        }

        function showConfirmation(result) {
            const confirmDiv = document.getElementById("confirmation-display");
            
            // Extract token with multiple fallbacks
            let tokenNumber = result.tokenNumber || 
                             result.appointment?.tokenNumber || 
                             result.appointment?._id?.slice(-6) || 
                             Math.floor(Math.random() * 1000000);
            
            // Safety check
            if (!tokenNumber || tokenNumber === 0 || tokenNumber === "0") {
              tokenNumber = result.appointment?._id?.slice(-6) || Math.floor(Math.random() * 1000000);
            }
            
            const appointment = result.appointment || {};

            confirmDiv.innerHTML = `
                <div class="confirmation-card">
                    <h2>‚úÖ Appointment Confirmed!</h2>
                    <div class="token-number">üéüÔ∏è ${tokenNumber}</div>
                    <p style="font-size: 1.1rem; margin: 10px 0;">Token saved for your records</p>
                </div>

                <div style="background: white; padding: 20px; border-radius: 10px;">
                    <h3 style="color: #667eea; margin-bottom: 15px;">Appointment Details</h3>
                    <div class="detail-row">
                        <span class="detail-label">Patient Name:</span>
                        <span>${appointment.patientName || "N/A"}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Contact:</span>
                        <span>${appointment.contactNumber || "N/A"}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Doctor:</span>
                        <span>${appointment.doctorName || "N/A"}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Specialization:</span>
                        <span>${appointment.specialization || "N/A"}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Hospital:</span>
                        <span>${appointment.organizationName || "N/A"}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Date:</span>
                        <span>${appointment.date || "N/A"}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Time Slot:</span>
                        <span>${appointment.timeSlot || "N/A"}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Location:</span>
                        <span>${appointment.location || "N/A"}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Status:</span>
                        <span style="color: #51cf66; font-weight: bold;">${appointment.status || "PENDING"}</span>
                    </div>
                    ${appointment.isEmergency ? `
                    <div class="detail-row" style="background: #ffe0e0; padding: 10px;">
                        <span class="detail-label">üö® Priority:</span>
                        <span style="color: #ff6b6b; font-weight: bold;">EMERGENCY - HIGH PRIORITY</span>
                    </div>
                    ` : ''}
                </div>
            `;
        }

        function moveToStep(stepNumber) {
            document.querySelectorAll(".step").forEach(step => step.classList.remove("active"));
            document.getElementById(`step${stepNumber}`).classList.add("active");

            document.querySelectorAll(".progress-step").forEach((step, index) => {
                step.classList.remove("active", "completed");
                if (index < stepNumber - 1) {
                    step.classList.add("completed");
                } else if (index === stepNumber - 1) {
                    step.classList.add("active");
                }
            });
        }

        function getNextDate(daysFromNow) {
            const date = new Date();
            date.setDate(date.getDate() + daysFromNow);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Initialize
        window.addEventListener("load", () => {
            autoFillSignup();
            const tomorrow = getNextDate(1);
            document.getElementById("search-date").value = tomorrow;
            authToken = localStorage.getItem("jwtToken");
            if (authToken) {
                moveToStep(2);
            }
        });

        // Handle emergency checkbox
        document.getElementById("emergency-check").addEventListener("change", function() {
            document.getElementById("emergency-reason-div").style.display = this.checked ? "block" : "none";
        });
    </script>
</body>
</html>
